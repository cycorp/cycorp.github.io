<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.6 at 2015-03-14 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Cyc Java API &#x2013; Query Searching</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20150314" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                        <a href="http://www.cyc.com/" id="bannerLeft">
                                                <img src="../images/cyclogo.png" alt="Cyc Java API" />
                </a>
                          <div id="bannerRight">
                Cyc Java API
                </div>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2015-03-14</span>
                  &nbsp;| <span id="projectVersion">Version: 1.0.0-rc1</span>
                      </div>
            <div class="xright">                    <a href="http://www.cyc.com/" class="externalLink" title="Cycorp">Cycorp</a>
            |
                        <a href="../../index.html" title="Developer Center">Developer Center</a>
            |
                        <a href="../index.html" title="Java API Resources">Java API Resources</a>
            |
                        <a href="../issues.html" title="Issues">Issues</a>
            |
                        <a href="../apidocs/index.html" title="Javadocs">Javadocs</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Cyc Developer Center</h5>
                  <ul>
                  <li class="none">
                          <a href="../../index.html" title="Introduction">Introduction</a>
            </li>
          </ul>
                       <h5>Cyc Java API</h5>
                  <ul>
                                                                                                        <li class="collapsed">
                          <a href="../index.html" title="Overview">Overview</a>
                  </li>
                  <li class="none">
                          <a href="../apidocs/" title="Javadocs">Javadocs</a>
            </li>
                                                                                                                                                      <li class="expanded">
                          <a href="../samples/index.html" title="Sample Code">Sample Code</a>
                    <ul>
                      <li class="none">
                          <a href="../samples/combined.html" title="Core API Usages">Core API Usages</a>
            </li>
                      <li class="none">
                          <a href="../samples/advanced-querying.html" title="Advanced Querying">Advanced Querying</a>
            </li>
                      <li class="none">
                          <a href="../samples/query-construction.html" title="Query Construction">Query Construction</a>
            </li>
                      <li class="none">
            <strong>Query Search</strong>
          </li>
                      <li class="none">
                          <a href="../samples/query-answer-justifying.html" title="Query Justification">Query Justification</a>
            </li>
              </ul>
        </li>
                  <li class="none">
                          <a href="../faq.html" title="FAQ">FAQ</a>
            </li>
                  <li class="none">
                          <a href="../download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="../issues.html" title="Issues">Issues</a>
            </li>
                  <li class="none">
                          <a href="../license.html" title="License">License</a>
            </li>
                  <li class="none">
                          <a href="../migration.html" title="Migration Guide">Migration Guide</a>
            </li>
          </ul>
                                          
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section">
<h2><a name="Query_Searching"></a>Query Searching</h2>
<p>Below is a complete file showing a variety of ways to use the QuerySearch class to get query fragments. NOTE: Query search is not supported in OpenCyc.</p>
<link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/default.min.css">
<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>
<script>
$(document).ready(function() {
  $('div.source pre').each(function(i, e) {hljs.highlightBlock(e)});
});
</script>

<div class="source">
<pre>package com.cyc.km.query.construction;



/*
 * #%L
 * File: QuerySearching.java
 * Project: Cyc API Use Cases
 * %%
 * Copyright (C) 1995 - 2014 Cycorp, Inc
 * %%
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *      http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * #L%
 */

import com.cyc.base.CycConnectionException;
import com.cyc.base.cycobject.CycObject;
import com.cyc.baseclient.nl.Paraphraser;
import com.cyc.kb.config.KBAPIConfiguration;
import com.cyc.km.modeling.task.CycBasedTask;
import com.cyc.query.Query;
import com.cyc.kb.KBObject;
import com.cyc.nl.Span;
import com.cyc.session.CycSessionManager;

import java.util.Collection;
import java.util.HashSet;
import java.util.Set;

import javax.xml.bind.JAXBException;


/**
 * Examples for using the QuerySearch class.
 *
 */
public class QuerySearching {

  private static final String searchString = &quot;What public corporations sell natural gas and what are their ticker symbols?&quot;;
  private static final String desiredTaskSummaryFragment = &quot;Natural Gas&quot;;

  public static void main(String[] args) {
    final String exampleName = QuerySearching.class.getSimpleName();
    try {
      System.out.println(&quot;Running &quot; +  exampleName + &quot;...&quot;);

      if (CycSessionManager.getCurrentSession().getServerInfo().isOpenCyc()) {
        System.out.println(&quot;The \&quot;Query Search\&quot; feature is not available in OpenCyc.&quot;);
        System.out.println(&quot;... &quot; +  exampleName + &quot; concluded.&quot;);
        System.exit(0);
      }
             
      KBAPIConfiguration.setShouldTranscriptOperations(false);
      QuerySearch querySearch = getQuerySearch();
      getAndDisplayTerms(querySearch);
      getAndDisplayQueries(querySearch);
    } catch (Exception e) {
      e.printStackTrace(System.err);
      System.exit(1);
    } finally {
      System.out.println(&quot;... &quot; +  exampleName + &quot; concluded.&quot;);
      System.exit(0);
    }
  }

  /**
   * Get a task with respect to which the query search will be performed.
   *
   * @return a task
   */
  public static CycBasedTask getATask() {
    // First, get all known tasks:
    final Set&lt;CycBasedTask&gt; allTasks = new HashSet&lt;CycBasedTask&gt;();
    try {
      allTasks.addAll(CycBasedTask.getAll());
      System.out.println(&quot;Got &quot; + allTasks.size() + &quot; tasks.&quot;);
    } catch (Exception ex) {
      System.err.println(&quot;Oops. Got exception finding set of Cyc-based tasks.&quot;);
      ex.printStackTrace(System.err);
    }
    // Then pick one you like:
    for (final CycBasedTask task : allTasks) {
      try {
        final String summary = task.getSummary();
        if (summary != null &amp;&amp; summary.contains(desiredTaskSummaryFragment)) {
          return task;
        }
      } catch (Exception ex) {
        System.err.println(&quot;Oops. Got exception checking &quot; + task);
        ex.printStackTrace(System.err);
      }
    }
    throw new RuntimeException(&quot;Failed to get a task mentioning '&quot; + desiredTaskSummaryFragment + &quot;'.&quot;);
  }

  /**
   * Print out the queries found by this search.
   *
   * @param querySearch
   * @throws Exception
   */
  public static void getAndDisplayQueries(final QuerySearch querySearch) throws CycConnectionException {
    final Collection&lt;Query&gt; queries = querySearch.getQueries();
    System.out.println(&quot;========================\nFound &quot; + queries.size()
            + &quot; queries:\n========================&quot;);
    Paraphraser paraphraser = getQueryParaphraser();
    for (final Query query : queries) {
      System.out.println(showLocations(querySearch.getSearchString(),
              querySearch.getQueryLocations(query)));
      System.out.println(&quot;CycL: &quot;
              + query.getQuerySentenceCyc());
      System.out.println(&quot;Gloss: &quot;
              + paraphraser.paraphrase(query).getString());
      System.out.println();
    }
  }

  /**
   * Print out the terms found by this search.
   *
   * @param querySearch
   * @throws Exception
   */
  public static void getAndDisplayTerms(final QuerySearch querySearch) throws CycConnectionException {
    final Collection&lt;KBObject&gt; terms = querySearch.getTerms();
    System.out.println(&quot;========================\nFound &quot; + terms.size()
            + &quot; terms:\n========================&quot;);
    Paraphraser termParaphraser = getTermParaphraser();
    for (final KBObject term : terms) {
      System.out.println(showLocations(querySearch.getSearchString(),
              querySearch.getTermLocations(term)));
      System.out.println(&quot;CycL: &quot; + term.toString());
      System.out.println(&quot;NL: &quot;
              + termParaphraser.paraphrase(term).getString());
      System.out.println();
    }
  }

  /**
   * Show the substrings demarcated by locations in searchString.
   *
   * @param searchString
   * @param locations
   * @return searchString with locations highlighted.
   */
  public static String showLocations(String searchString,
          Collection&lt;? extends Span&gt; locations) {
    String result = searchString;
    for (final Span location : locations) {
      result = showLocation(result, location);
    }
    return result;
  }

  /**
   * Highlight location in searchString.
   *
   * @param searchString
   * @param location
   * @return searchString with location highlighted.
   */
  public static String showLocation(String searchString, Span location) {
    final int startIndex = location.getOffset();
    final int endIndex = location.getEnd() + 1;
    return searchString.substring(0, startIndex) + '|'
            + searchString.substring(startIndex, endIndex) + '|'
            + searchString.substring(endIndex);
  }

  /**
   * Get a paraphraser suitable for paraphrasing queries.
   * &lt;p/&gt;If the Cyc NL API is not available, the paraphrases will be extremely
   * primitive, typically just the CycL string.
   * @see Paraphraser#getInstance(com.cyc.baseclient.nl.Paraphraser.ParaphrasableType).
   *
   * @return the paraphraser
   */
  public static Paraphraser getQueryParaphraser() {
    // Get a generic paraphraser:
    final Paraphraser paraphraser = Paraphraser.getInstance(Paraphraser.ParaphrasableType.QUERY);
    // This could be set either way. Experimentation encouraged!
    //paraphraser.setBlanksForVars(true); //this doesn't exist in the general paraphraser interface.  Only in the actual QueryParaphraser interface.
    return paraphraser;
  }

  /**
   * Get a paraphraser suitable for paraphrasing terms.
   * &lt;p/&gt;If the Cyc NL API is not available, the paraphrases will be extremely
   * primitive, typically just the CycL string.
   * @see Paraphraser#getInstance(com.cyc.baseclient.nl.Paraphraser.ParaphrasableType).
   *
   * @return the paraphraser
   */
  public static Paraphraser getTermParaphraser() {
    final Paraphraser&lt;CycObject&gt; cycObjectParaphraser = Paraphraser.getInstance(Paraphraser.ParaphrasableType.KBOBJECT);
    // Set the force appropriately for terms:
    //cycObjectParaphraser.setForce(NLForce.None);
    /** Wrap our CycObject paraphraser in an KBObject paraphraser that will delegate
     * paraphrasing of the Cyc objects to it:
     * */
    return cycObjectParaphraser;
  }

  /**
   * Get a query search object initialized for a sample search string and task.
   *
   * @return the QuerySearch object for the sample task
   * @throws JAXBException
   */
  public static QuerySearch getQuerySearch() throws JAXBException {
    final CycBasedTask task = getATask();
    final QuerySearch querySearch = new QuerySearch(searchString, task);
    return querySearch;
  }
}
</pre></div></div>
      </div>


      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'cycdev'; // required: replace example with your forum shortname

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>



    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2013&#x2013;2015
                        <a href="http://www.cyc.com">Cycorp, Inc</a>.
            All rights reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
